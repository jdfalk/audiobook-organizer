# file: .github/repository-config.yml
# version: 1.2.1
# guid: audiobook-organizer-repo-config-001

# Repository Metadata
repository:
  name: 'audiobook-organizer'
  type: 'application'
  primary_language: 'go'
  description: 'Audiobook organization and management tool'

# Frontend Configuration (top-level for get-frontend-config-action)
working_directories:
  frontend: 'web'
  node: 'web'

versions:
  node: ['22']

# Language Detection and Support
languages:
  detection:
    patterns:
      go:
        - 'go.mod'
        - 'go.sum'
        - 'main.go'
        - 'cmd/'
        - 'internal/'
      javascript:
        - 'web/package.json'
        - 'web/*.js'
      docker:
        - 'Dockerfile'
        - 'docker-compose.yml'

    priority:
      - go
      - javascript
      - docker

  versions:
    go: ['1.25']
    node: ['22']

  # Working directories for language-specific builds
  working_directories:
    node: 'web'
    frontend: 'web'

# Build Configuration
build:
  platforms:
    os: ['ubuntu-latest']
    arch: ['amd64', 'arm64']

  docker:
    enabled: true
    platforms: ['linux/amd64,linux/arm64'] # buildx handles multi-platform
    registries: ['ghcr.io']
    use_qemu: false # Not needed with buildx

  cross_compile:
    enabled: true
    targets:
      go:
        - 'linux/amd64'
        - 'linux/arm64'
        - 'darwin/amd64'
        - 'darwin/arm64'

# Release Configuration
release:
  enabled: true
  strategy: 'semantic'
  prerelease_branch: 'main'
  stable_branches: ['main']

  versioning:
    scheme: 'semver'
    auto_detect: true

  artifacts:
    go_binaries: true
    docker_images: true
    source: true
    checksums: true

  goreleaser:
    config: '.goreleaser.yml'
    publish: true

# Testing Configuration
testing:
  enabled: true
  coverage:
    enabled: true
    threshold: 80
    reports: ['html', 'json']

  unit:
    enabled: true
    parallel: true

  integration:
    enabled: true

  e2e:
    enabled: true
    config: 'web/tests/e2e/playwright.config.ts'
    browsers: ['chromium']

# CI Configuration
ci:
  enabled: true
  on:
    push: ['main']
    pull_request: ['main']

  caching:
    enabled: true
    strategy: manual
    paths:
      go: ['~/.cache/go-build', '~/go/pkg/mod']
      npm: ['~/.npm', '~/.cache/npm']
    lock_files:
      npm: 'web/package-lock.json'
