# file: .github/workflows/frontend-ci.yml
# version: 2.7.1
# guid: 1c2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f

name: Frontend CI

on:
  push:
    branches: [main, develop]
    paths:
      - 'web/**'
      - '.github/workflows/frontend-ci.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'web/**'
      - '.github/workflows/frontend-ci.yml'

permissions:
  contents: write
  actions: write
  checks: write
  packages: write
  id-token: write
  attestations: write

jobs:
  frontend-config:
    name: Determine Frontend Configuration
    runs-on: ubuntu-latest
    outputs:
      dir: ${{ steps.frontend-config.outputs.dir }}
      node-version: ${{ steps.frontend-config.outputs.node-version }}
      has-frontend: ${{ steps.frontend-config.outputs.has-frontend }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: Load frontend configuration
        id: frontend-config
        uses: jdfalk/get-frontend-config-action@c48769f8cfde4b3c83f797d585bf87a11f606a6a # v1.1.2
        with:
          repository-config: ''
          config-file: '.github/repository-config.yml'

  frontend:
    name: Frontend Build and Test
    needs: frontend-config
    if: needs.frontend-config.outputs.has-frontend == 'true'
    uses: jdfalk/ghcommon/.github/workflows/reusable-ci.yml@13fefc2d0ba51d77a2eae9afc6805e9080ad3174 # v1.10.1
    with:
      node-version: ${{ needs.frontend-config.outputs.node-version }}
    secrets: inherit
