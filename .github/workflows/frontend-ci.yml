# file: .github/workflows/frontend-ci.yml
# version: 2.8.0
# guid: 1c2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f

name: Frontend CI

on:
  push:
    branches: [main, develop]
    paths:
      - 'web/**'
      - '.github/workflows/frontend-ci.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'web/**'
      - '.github/workflows/frontend-ci.yml'

permissions:
  contents: write
  actions: write
  checks: write
  packages: write
  id-token: write
  attestations: write

jobs:
  frontend-config:
    name: Determine Frontend Configuration
    runs-on: ubuntu-latest
    outputs:
      dir: ${{ steps.frontend-config.outputs.dir }}
      node-version: ${{ steps.frontend-config.outputs.node-version }}
      has-frontend: ${{ steps.frontend-config.outputs.has-frontend }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Load frontend configuration
        id: frontend-config
        uses: jdfalk/get-frontend-config-action@3d728dd5c1f057dfdc97fc6eb3ca1e8fe8ba3a1b # v1.1.3
        with:
          repository-config: ''
          config-file: '.github/repository-config.yml'

  frontend:
    name: Frontend Build and Test
    needs: frontend-config
    if: needs.frontend-config.outputs.has-frontend == 'true'
    uses: jdfalk/ghcommon/.github/workflows/reusable-ci.yml@94259607508ce3ecaff67347c1cf59a3bd336f60 # v2.9.0
    with:
      node-version: ${{ needs.frontend-config.outputs.node-version }}
    secrets: inherit
