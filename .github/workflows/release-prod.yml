# file: .github/workflows/release-prod.yml
# version: 4.7.0
# guid: f1a2b3c4-d5e6-7f8a-9b0c-1d2e3f4a5b6c

name: Production Release

on:
  workflow_dispatch:
    inputs:
      release-type:
        description: 'Release type'
        required: true
        type: choice
        options:
          - auto
          - major
          - minor
          - patch
        default: 'auto'
      create-draft:
        description: 'Create as draft release'
        required: false
        type: boolean
        default: false

concurrency:
  group: release-${{ github.ref }}
  cancel-in-progress: false

permissions:
  contents: write
  packages: write
  id-token: write
  attestations: write

jobs:
  release:
    name: Create Production Release
    uses: jdfalk/ghcommon/.github/workflows/reusable-release.yml@94259607508ce3ecaff67347c1cf59a3bd336f60 # v2.9.0
    with:
      release-type: ${{ github.event.inputs.release-type }}
      prerelease: false
      draft: ${{ github.event.inputs.create-draft == 'true' }}
      go-enabled: true
      frontend-enabled: true
      docker-enabled: true
      system-packages: 'libtag1-dev'
      pre-build-script: 'cd web && npm ci && npm run build'
    secrets: inherit
