# file: .github/workflows/prerelease.yml
# version: 2.7.0
# guid: a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6d

name: Prerelease on Merge

on:
  push:
    branches: [main]
    paths-ignore:
      - '**.md'
      - 'docs/**'

concurrency:
  group: prerelease-${{ github.ref }}
  cancel-in-progress: false

permissions:
  contents: write
  packages: write
  id-token: write
  attestations: write

env:
  GHCOMMON_SCRIPTS_DIR: ${{ github.workspace }}/.github/workflows/scripts

jobs:
  prerelease:
    name: Create Prerelease Build
    uses: jdfalk/ghcommon/.github/workflows/reusable-release.yml@1a96daebeba7b0f61037be5bc381e3b6794e26b5 # v2.9.0
    with:
      release-type: 'auto'
      prerelease: true
      draft: false
      go-enabled: true
      frontend-enabled: true
      docker-enabled: true
      system-packages: 'libtag1-dev'
      pre-build-script: 'cd web && npm ci && npm run build'
    secrets: inherit
